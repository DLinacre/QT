<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improved Text Handling</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .truncated {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%; /* Adjustable max width */
        }
    </style>
</head>
<body>
    <div class="truncated" id="longName">This is an extremely long name that we want to handle correctly to avoid overflow issues in our layout.</div>
    <script>
        function adjustFontSize() {
            const element = document.getElementById('longName');
            const emojiPattern = /[\u{1F600}-\u{1F64F}]/gu; // Emoji regex
            const widthLimit = 300; // Set a width limit for the element

            if (element.scrollWidth > widthLimit) {
                // Decrease font size until it fits
                let fontSize = parseFloat(window.getComputedStyle(element).fontSize);
                while (element.scrollWidth > widthLimit && fontSize > 10) {
                    fontSize -= 1;
                    element.style.fontSize = fontSize + 'px';
                }
            }

            // Limit emoji code width
            const emojis = element.innerHTML.match(emojiPattern);
            if (emojis) {
                element.innerHTML = element.innerHTML.replace(emojiPattern, '<span style="font-size: 0.8em;">$&</span>');
            }
        }

        window.onload = adjustFontSize;
        window.onresize = adjustFontSize; // Adjust on window resize
    </script>
</body>
</html>